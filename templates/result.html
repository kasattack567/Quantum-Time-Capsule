<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Meta and Title -->
    <meta charset="UTF-8">
    <title>Your Encrypted Message - Quantum Time Capsule</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

    <!-- Include Select2 CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Instrument+Sans&family=Red+Hat+Mono&display=swap" rel="stylesheet">

    <!-- Inline CSS -->
    <style>
        /* Ensure html and body can grow with content */
        html, body {
            min-height: 100%;
            margin: 0;
            padding: 0;
        }
        
        /* Adjust Select2 styling to match your input fields */
        .select2-container .select2-selection--single {
            height: calc(1.5em + .75rem + 2px); /* Match Bootstrap's input height */
            background-color: #2e2e2e;
            border: 1px solid #444;
            border-radius: .25rem;
            padding: .375rem .75rem;
            color: #d4d4d4;
        }

        .select2-container--bootstrap4 .select2-selection--single .select2-selection__rendered {
            line-height: 1.5;
        }

        .select2-container--bootstrap4 .select2-selection--single .select2-selection__arrow {
            height: 100%;
        }

        .select2-dropdown {
            background-color: #1e1e1e;
            color: #d4d4d4;
        }

        .select2-results__option {
            padding: .5rem .75rem;
        }

        .select2-search--dropdown .select2-search__field {
            background-color: #2e2e2e;
            border: 1px solid #444;
            color: #d4d4d4;
        }

        .select2-search--dropdown .select2-search__field::placeholder {
            color: #6c757d;
        }

        body {
            background: conic-gradient(
                from 59deg, /* Starting angle */
                #10182E 0%,
                #19244A 10%,
                #252867 20%,
                #1A3A66 40%,
                #1B3C4F 60%,
                #0A1C51 80%,
                #151D32 100%
            );
            background-position: center; /* Center the gradient */
            background-size: 100% 100%; /* Stretch background to fill body */
            background-repeat: no-repeat; /* Prevent repetition of the gradient */
            background-attachment: fixed; /* Keep background fixed */
            color: #fff; /* Set text color to white */
            font-family: 'Roboto', sans-serif;
            padding-top: 70px; /* Prevent content overlap with navbar */
        }

        h1, h2, h3, h4 {
            font-family: "Instrument Sans", sans-serif;
            color: #fff; /* Light text color */
        }

        p, label {
            font-size: 1.1rem;
            line-height: 1.7;
            color: #d4d4d4; /* Light gray text color */
        }

        /* Navigation bar styling */
        .header-container {
            display: flex;
            width: 100%;
            gap: 20px;
            justify-content: space-between;
            align-items: center; /* Vertically center the items */
            padding: 20px 40px;
            font-family: 'Red Hat Mono', monospace; /* Updated font family */
            position: fixed;
            top: 0;
            left: 0;
            background-color: transparent;
            z-index: 1000;
        }

        .brand-title {
            font-family: 'Instrument Sans', sans-serif; /* Updated font family */
            font-size: 1.875rem; /* Equivalent to 30px */
            font-weight: 500;
            text-transform: lowercase;
            color: #fff;
            margin: 0;
        }

        .nav-menu {
            display: flex;
            align-items: center;
            gap: 40px;
            font-size: 1rem; /* Equivalent to 16px */
        }

        .nav-item {
            color: #d4d4d4;
            text-decoration: none;
            text-transform: lowercase;
            transition: color 0.3s;
        }

        .nav-item:hover {
            color: #fff;
        }

        /* Container and Text Styling */
        .container, .container-fluid {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Email Draft Textarea */
        #emailDraft {
            background-color: #1e1e1e; /* Dark background */
            color: #d4d4d4; /* Light text color */
            font-family: "Red Hat Mono", monospace;
            font-size: 1rem;
            resize: none;
            border: 1px solid #444;
        }

        /* Button Styling */
        .btn-secondary {
            background-color: #1a2a9f;
            border-color: #1a2a9f;
            font-family: "Red Hat Mono", monospace;
            color: #fff;
            text-transform: lowercase;
        }

        .btn-secondary:hover {
            background-color: #14207d;
            border-color: #14207d;
        }

        /* Footer Section */
        footer {
            text-align: center;
            padding: 30px 0;
            background-color: transparent; /* Match navbar background */
            color: #d4d4d4;
            font-family: "Roboto", sans-serif;
            margin-top: 40px;
        }

        /* Modal Styling */
        .modal-content {
            background-color: #1e1e1e;
            color: #d4d4d4;
        }

        .modal-header, .modal-footer {
            border: none;
        }

        .modal-title {
            font-family: "Instrument Sans", sans-serif;
            color: #fff;
            text-transform: lowercase;
        }

        /* Form Control Styling */
        .form-control {
            background-color: #2e2e2e;
            color: #d4d4d4;
            font-size: 1rem;
            border: 1px solid #444;
        }

        .form-control::placeholder {
            color: #6c757d;
        }

        /* Close Button Styling in Modal */
        .close {
            color: #fff;
            opacity: 0.8;
        }

        .close:hover {
            color: #fff;
            opacity: 1;
        }

        /* Adjust margins */
        .mt-2 {
            margin-top: 1rem !important;
        }

        .mt-3 {
            margin-top: 1.5rem !important;
        }

        .mt-4 {
            margin-top: 2rem !important;
        }

        .py-5 {
            padding-top: 3rem !important;
            padding-bottom: 3rem !important;
        }

        /* Adjust textarea height */
        #emailDraft {
            height: auto;
            min-height: 300px;
        }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            #emailDraft {
                font-size: 0.9rem;
            }

            .header-container {
                flex-direction: column;
                align-items: flex-start;
                padding: 10px 20px;
            }

            .nav-menu {
                flex-wrap: wrap;
                gap: 20px;
                margin-top: 10px;
            }
        }
        /* Step 7: Ensure Select2 dropdown has scrollbars when needed */
        .select2-container .select2-dropdown {
            max-height: 200px; /* Adjust as needed */
            overflow-y: auto;
        }

        /* Optional: Adjust the styling of the scrollbar */
        .select2-container .select2-results__options::-webkit-scrollbar {
            width: 8px;
        }

        .select2-container .select2-results__options::-webkit-scrollbar-track {
            background: #1e1e1e;
        }

        .select2-container .select2-results__options::-webkit-scrollbar-thumb {
            background-color: #444;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <header class="header-container">
        <h1 class="brand-title">quantum time capsule</h1>
        <nav class="nav-menu">
            <a href="{{ url_for('index') }}" class="nav-item">new capsule</a>
            <a href="{{ url_for('explore_more') }}" class="nav-item">how it works</a>
            <a href="{{ url_for('demographics') }}" class="nav-item">who's using</a>
            <a href="{{ url_for('about') }}" class="nav-item">about us</a>
        </nav>
    </header>

    <div class="container-fluid py-5" style="padding-top: 140px;">
        <!-- Pre-written Email Section -->
        <section id="prewritten-email" class="text-center">
            <div class="container">
                <h1 class="mb-4"> >> encrypted message</h1>
                <p>copy this draft email to send to your friends</p>

                <div class="border p-4" style="background-color: rgba(30, 30, 30, 0.8);">
                    <!-- Hidden input to store message_id -->
                    <input type="hidden" id="message_id" value="{{ message_data.message_id }}">

                    <!-- Draft Email Content -->
                    <textarea id="emailDraft" class="form-control mt-2" rows="12" readonly>
Hi,

The following message is a quantum time capsule. 

You will need to factorise this number to read the message:

Public Key Modulus (N):
{{ message_data.public_key_n }}

Encrypted Message:
{{ message_data.ciphertext }}

Public Exponent (e):
{{ message_data.public_exponent_e }}

The message was encrypted using the RSA cryptosystem, and its secret key was intentionally deleted, so it can only be read when large quantum computers are built.

Visit quantumtimecapsule.com to find out more and make your own quantum time capsules! 
                    </textarea>

                    <!-- Copy button -->
                    <div class="mt-3">
                        <button class="btn btn-secondary btn-lg" onclick="copyToClipboard('emailDraft')">copy draft email</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer Section -->
        <footer>
            <p>&copy; 2024 Quantum Time Capsule. Created with future technology in mind.</p>
        </footer>
    </div>

    <!-- Demographics Modal -->
    <div class="modal fade" id="demographicsModal" tabindex="-1" aria-labelledby="demographicsModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">tell us about yourself</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true" style="color: #fff;">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="demographicsForm">
                        <div class="form-group">
                            <label for="name">name (optional)</label>
                            <input type="text" class="form-control" id="name" placeholder="enter your name">
                        </div>
                        <div class="form-group">
                            <label for="email">email (optional)</label>
                            <input type="email" class="form-control" id="email" placeholder="enter your email">
                        </div>
                        <!-- Country Field -->
                        <div class="form-group">
                            <label for="country">country (optional)</label>
                            <select class="form-control" id="country" name="country" style="width: 100%;">
                                <option value="" disabled selected hidden>Select or type your country</option>
                            </select>                            
                        </div>
                        <!-- Occupation Field -->
                        <div class="form-group">
                            <label for="occupation">occupation/field of study (optional)</label>
                            <select class="form-control" id="occupation" name="occupation" style="width: 100%;">
                                <option value="" disabled selected hidden>Select or type your occupation</option>
                            </select>                            
                        </div>
                        <div class="form-group">
                            <label for="age">age (optional)</label>
                            <input type="number" class="form-control" id="age" placeholder="enter your age">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">skip</button>
                    <button type="button" class="btn btn-primary" onclick="submitDemographics()">submit</button>
                </div>
            </div>
        </div>
    </div>

    <!-- jQuery and Bootstrap JS (load these first) -->
    <!-- jQuery (must be loaded before Select2 JS) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Include Select2 JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>

    <!-- Popper.js for Bootstrap 4 -->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>

    <!-- Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <!-- Your custom script (place this after the above scripts) -->
    <script>
        // Convert countries and occupations to JavaScript arrays
        var countries = {{ countries | tojson }};
        var occupations = {{ occupations | tojson }};
        
        $(document).ready(function() {
            // Initialize Select2 for the country field
            $('#country').select2({
                placeholder: "Select or type your country",
                data: countries.map(function(country) { return { id: country, text: country }; }),
                tags: true, // Enables typing custom values
                allowClear: true, // Allow clearing the selection
                width: 'resolve', // Adjusts width to the element
                theme: 'bootstrap4' // Match Bootstrap 4 styling
            });

            // Initialize Select2 for the occupation field
            $('#occupation').select2({
                placeholder: "Select or type your occupation",
                data: occupations.map(function(occupation) { return { id: occupation, text: occupation }; }),
                tags: true,
                allowClear: true,
                width: 'resolve',
                theme: 'bootstrap4'
            });
        });
    </script> 
    <script>
        // Copy to Clipboard Script
        function copyToClipboard(id) {
            var copyText = document.getElementById(id);
            copyText.select();
            copyText.setSelectionRange(0, 99999); /* For mobile devices */
            document.execCommand('copy');
            alert('Draft email copied to clipboard');
        }

        // Show the demographics modal when the page loads
        $(document).ready(function() {
            console.log('Page is ready, showing modal');
            $('#demographicsModal').modal('show');
        });

        function submitDemographics() {
            const message_id = document.getElementById('message_id').value;
            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            const country = $('#country').val(); // Use jQuery to get Select2 value
            const occupation = $('#occupation').val(); // Use jQuery for Select2
            const age = document.getElementById('age').value;

            console.log('Submitting demographics:', { message_id, name, email, country, occupation, age });

            $.ajax({
                type: 'POST',
                url: '/submit_demographics',
                data: {
                    message_id: message_id,
                    name: name,
                    email: email,
                    country: country,
                    occupation: occupation,
                    age: age
                },
                success: function(response) {
                    console.log('Demographics submitted:', response);
                    alert('Thank you for your submission!');
                    $('#demographicsModal').modal('hide');
                },
                error: function(error) {
                    console.error('Error submitting demographics:', error);
                    alert('Error submitting demographics. Please try again.');
                }
            });
        }
    </script>    
</body>
</html>
